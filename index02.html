<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>æ—¥æœ¬ã®è¾²æ¥­å¾“äº‹è€… - åœ°åŸŸåˆ¥åˆ†å¸ƒ</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  min-height: 100vh;
  background: linear-gradient(160deg, #0f1923 0%, #1a2a1a 60%, #0f1923 100%);
  font-family: 'Noto Sans JP', sans-serif;
  color: #e8f5e9;
  padding: 20px 14px 50px;
}
.header { text-align: center; margin-bottom: 20px; }
.title {
  font-size: clamp(18px, 5.5vw, 26px); font-weight: 900; letter-spacing: 1px;
  background: linear-gradient(90deg, #22c55e, #84cc16);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  margin-bottom: 6px; line-height: 1.3;
}
.subtitle { color: #86efac; font-size: clamp(10px, 2.8vw, 12px); line-height: 1.6; }
.tabs { display: flex; justify-content: center; gap: 6px; margin-bottom: 16px; flex-wrap: nowrap; width: 100%; }
.tab {
  padding: 7px 10px; border-radius: 999px; border: none; cursor: pointer;
  font-size: clamp(10px, 2.6vw, 12px); font-weight: 700;
  font-family: 'Noto Sans JP', sans-serif; transition: all 0.2s;
  -webkit-tap-highlight-color: transparent; white-space: nowrap; flex: 1; text-align: center;
}
.tab.active { background: linear-gradient(90deg, #22c55e, #84cc16); color: #000; box-shadow: 0 0 14px #22c55e44; }
.tab.inactive { background: rgba(255,255,255,0.07); color: #86efac; }
.chart-box {
  background: rgba(255,255,255,0.04);
  border-radius: 18px; border: 1px solid rgba(134,239,172,0.15);
  padding: 16px 12px 14px;
  max-width: 600px; margin: 0 auto 16px;
  box-shadow: 0 8px 40px rgba(0,0,0,0.4);
}
.chart-title { text-align: center; color: #86efac; font-size: clamp(11px,3vw,13px); margin-bottom: 12px; font-weight: 700; }
.age-legend { display: flex; justify-content: center; gap: 14px; margin-top: 10px; flex-wrap: wrap; }
.age-item { display: flex; align-items: center; gap: 5px; font-size: 11px; color: #aaa; }
.age-dot { width: 11px; height: 11px; border-radius: 3px; }
.region-select-wrap { max-width: 600px; margin: 0 auto 14px; }
.region-label { color: #86efac; font-size: 11px; margin-bottom: 6px; text-align: center; }
.region-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; }
.rgn-btn {
  padding: 9px 4px; border-radius: 10px; border: 1px solid rgba(134,239,172,0.2);
  background: rgba(255,255,255,0.04); color: #86efac;
  font-size: clamp(9px, 2.5vw, 11px); font-weight: 700; cursor: pointer;
  font-family: 'Noto Sans JP', sans-serif; text-align: center;
  transition: all 0.15s; -webkit-tap-highlight-color: transparent; line-height: 1.3;
}
.rgn-btn.active { background: rgba(34,197,94,0.2); border-color: #22c55e; color: #fff; }
.summary-grid {
  max-width: 600px; margin: 0 auto 14px;
  display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
}
.sum-card {
  background: rgba(255,255,255,0.04); border-radius: 14px; padding: 12px 14px;
  border: 1px solid rgba(255,255,255,0.07);
}
.sum-emoji { font-size: 18px; margin-bottom: 4px; }
.sum-label { color: #64748b; font-size: 10px; margin-bottom: 2px; }
.sum-value { font-weight: 900; font-size: clamp(14px,4vw,18px); }
.sum-sub { color: #64748b; font-size: 10px; margin-top: 2px; }
.insight-row { display: flex; align-items: center; margin-bottom: 8px; }
.insight-name { font-size: 11px; color: #ccc; min-width: 58px; }
.insight-bar-wrap { flex: 1; margin: 0 8px; height: 7px; background: rgba(255,255,255,0.08); border-radius: 99px; overflow: hidden; }
.insight-bar { height: 100%; border-radius: 99px; transition: width 0.5s ease; }
.insight-num { font-size: 11px; font-weight: 700; min-width: 38px; text-align: right; }
.view { display: none; }
.view.active { display: block; }
.note { text-align: center; color: #334155; font-size: 10px; margin-top: 18px; padding: 0 10px; line-height: 1.7; }
</style>
</head>
<body>

<div class="header">
  <div class="title">è¾²æ¥­å¾“äº‹è€… åœ°åŸŸåˆ¥åˆ†å¸ƒ</div>
  <div class="subtitle">8åœ°åŸŸ Ã— å¹´é½¢å±¤ Ã— å¾“äº‹è€…æ•°<br>ï¼ˆ2020å¹´è¾²æ—æ¥­ã‚»ãƒ³ã‚µã‚¹æ¨è¨ˆï¼‰</div>
</div>

<div class="tabs">
  <button class="tab active" onclick="switchView('corp')">ğŸ¢ æ³•äººvså€‹äºº</button>
  <button class="tab inactive" onclick="switchView('indiv')">ğŸ‘¤ å€‹äººè©³ç´°</button>
</div>

<!-- VIEW 1 -->
<div id="view-regional" class="view">
  <div class="chart-box">
    <div class="chart-title">åœ°åŸŸåˆ¥ è¾²æ¥­å¾“äº‹è€…æ•°ã¨å¹´é½¢å±¤æ§‹æˆï¼ˆåƒäººï¼‰</div>
    <canvas id="regionalChart"></canvas>
    <div class="age-legend">
      <div class="age-item"><div class="age-dot" style="background:#4ade80"></div>è‹¥å¹´ï¼ˆã€œ49æ­³ï¼‰</div>
      <div class="age-item"><div class="age-dot" style="background:#facc15"></div>ä¸­å¹´ï¼ˆ50ã€œ64æ­³ï¼‰</div>
      <div class="age-item"><div class="age-dot" style="background:#f87171"></div>é«˜é½¢ï¼ˆ65æ­³ã€œï¼‰</div>
    </div>
  </div>
</div>


<!-- VIEW BUBBLE -->
<div id="view-bubble" class="view">
  <div class="chart-box">
    <div class="chart-title">ä½œæ¥­ã®é‡ã• Ã— å¹³å‡å¹´é½¢ã€€ï¼ˆãƒãƒ–ãƒ«ï¼å¾“äº‹è€…æ•°ï¼‰</div>
    <div style="text-align:center;color:#64748b;font-size:10px;margin-bottom:10px">â† è»½ã„ä½œæ¥­ï¼ˆèŠ±ããƒ»é‡èœç³»ï¼‰ã€€ã€€é‡ã„ä½œæ¥­ï¼ˆç±³ãƒ»éº¦ï¼‰â†’</div>
    <canvas id="bubbleChart"></canvas>
  </div>
  <div class="chart-box" style="padding:14px 16px">
    <div class="chart-title" style="margin-bottom:10px">å„åœ°åŸŸã®ä¸»è¦ä½œç‰©ã¨ç‰¹å¾´</div>
    <div id="bubbleLegend" style="display:grid;grid-template-columns:1fr 1fr;gap:8px"></div>
  </div>
</div>

<!-- VIEW 2 -->
<div id="view-detail" class="view">
  <div class="region-select-wrap">
    <div class="region-label">åœ°åŸŸã‚’é¸ã‚“ã§ãã ã•ã„</div>
    <div class="region-grid" id="regionBtns"></div>
  </div>
  <div class="summary-grid">
    <div class="sum-card">
      <div class="sum-emoji">ğŸ‘¨â€ğŸŒ¾</div>
      <div class="sum-label">è¾²æ¥­å¾“äº‹è€…æ•°ï¼ˆæ¨è¨ˆï¼‰</div>
      <div class="sum-value" id="d-total">â€”</div>
      <div class="sum-sub" id="d-pct">å…¨å›½ã‚·ã‚§ã‚¢ â€”%</div>
    </div>
    <div class="sum-card">
      <div class="sum-emoji">ğŸ‚</div>
      <div class="sum-label">æ¨è¨ˆå¹³å‡å¹´é½¢</div>
      <div class="sum-value" id="d-age">â€”</div>
      <div class="sum-sub" id="d-age-label">â€”</div>
    </div>
    <div class="sum-card">
      <div class="sum-emoji">ğŸŒ±</div>
      <div class="sum-label">è‹¥å¹´ï¼ˆã€œ49æ­³ï¼‰ã®å‰²åˆ</div>
      <div class="sum-value" id="d-young">â€”</div>
      <div class="sum-sub" id="d-young-abs">â€”åƒäºº</div>
    </div>
    <div class="sum-card">
      <div class="sum-emoji">ğŸŒ¾</div>
      <div class="sum-label">ä¸»è¦è¾²ç”£ç‰©</div>
      <div class="sum-value" id="d-crop" style="font-size:clamp(11px,3vw,13px)">â€”</div>
      <div class="sum-sub" id="d-feature">â€”</div>
    </div>
  </div>
  <div class="chart-box">
    <div class="chart-title" id="d-chart-title">å¹´é½¢å±¤æ§‹æˆï¼ˆãƒ‰ãƒ¼ãƒŠãƒ„ï¼‰</div>
    <canvas id="detailChart"></canvas>
  </div>
</div>

<!-- VIEW 3 -->
<div id="view-rank" class="view">
  <div class="chart-box">
    <div class="chart-title">ğŸŒ± è‹¥å¹´è¾²æ¥­è€…ï¼ˆã€œ49æ­³ï¼‰ã®å‰²åˆ</div>
    <div id="youngRankList" style="padding:4px 0"></div>
  </div>
  <div class="chart-box">
    <div class="chart-title">ğŸ‚ æ¨è¨ˆå¹³å‡å¹´é½¢ï¼ˆä½ã„é †ï¼è‹¥ã„ï¼‰</div>
    <div id="ageRankList" style="padding:4px 0"></div>
  </div>
  <div class="chart-box">
    <div class="chart-title">ğŸ‘¨â€ğŸŒ¾ è¾²æ¥­å¾“äº‹è€…æ•°ï¼ˆå¤šã„é †ï¼‰</div>
    <div id="totalRankList" style="padding:4px 0"></div>
  </div>
</div>


<!-- VIEW CORP -->
<div id="view-corp" class="view active">

  <!-- Big summary cards -->
  <div style="max-width:600px;margin:0 auto 14px;display:grid;grid-template-columns:1fr 1fr;gap:10px">
    <div style="background:rgba(99,102,241,0.12);border:1px solid #6366f1;border-radius:16px;padding:14px;text-align:center">
      <div style="font-size:22px;margin-bottom:4px">ğŸ¢</div>
      <div style="color:#a5b4fc;font-size:10px;margin-bottom:4px">æ³•äººãƒ»å›£ä½“çµŒå–¶ä½“</div>
      <div style="font-size:clamp(26px,8vw,36px);font-weight:900;color:#818cf8">40%</div>
      <div style="color:#6366f1;font-size:10px;margin-top:2px">çµŒå–¶ä½“æ•°ã¯ã‚ãšã‹3.5%</div>
      <div style="color:#94a3b8;font-size:9px;margin-top:4px">ç´„3.1ä¸‡çµŒå–¶ä½“</div>
    </div>
    <div style="background:rgba(34,197,94,0.1);border:1px solid #22c55e;border-radius:16px;padding:14px;text-align:center">
      <div style="font-size:22px;margin-bottom:4px">ğŸ‘¨â€ğŸŒ¾</div>
      <div style="color:#86efac;font-size:10px;margin-bottom:4px">å€‹äººçµŒå–¶ä½“</div>
      <div style="font-size:clamp(26px,8vw,36px);font-weight:900;color:#4ade80">60%</div>
      <div style="color:#22c55e;font-size:10px;margin-top:2px">çµŒå–¶ä½“æ•°ã¯96.5%</div>
      <div style="color:#94a3b8;font-size:9px;margin-top:4px">ç´„103.7ä¸‡çµŒå–¶ä½“</div>
    </div>
  </div>

  <div style="max-width:600px;margin:0 auto 6px;text-align:center;color:#94a3b8;font-size:10px;padding:0 4px">
    â€» è¾²ç”£ç‰©è²©å£²é‡‘é¡è¦æ¨¡åˆ¥çµŒå–¶ä½“æ•°ã«å„éšå±¤ä¸­é–“å€¤ã‚’ä¹—ã˜ãŸè¾²æ°´çœæ¨è¨ˆ
  </div>

  <!-- Donut + trend side by side -->
  <div style="max-width:600px;margin:0 auto 14px;display:grid;grid-template-columns:1fr 1fr;gap:10px">
    <div style="background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);border-radius:16px;padding:12px">
      <div style="text-align:center;color:#86efac;font-size:11px;font-weight:700;margin-bottom:8px">è²©å£²é‡‘é¡ã‚·ã‚§ã‚¢ï¼ˆ2020å¹´ï¼‰</div>
      <canvas id="corpDonut" height="160"></canvas>
    </div>
    <div style="background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);border-radius:16px;padding:12px">
      <div style="text-align:center;color:#86efac;font-size:11px;font-weight:700;margin-bottom:8px">æ³•äººã‚·ã‚§ã‚¢ã®æ¨ç§»</div>
      <canvas id="corpTrend" height="160"></canvas>
    </div>
  </div>

  <!-- Sales band breakdown -->
  <div style="background:rgba(255,255,255,0.04);border:1px solid rgba(134,239,172,0.15);border-radius:18px;padding:16px 14px;max-width:600px;margin:0 auto 14px">
    <div style="text-align:center;color:#86efac;font-size:12px;font-weight:700;margin-bottom:14px">å£²ä¸Šè¦æ¨¡å¸¯åˆ¥ æ³•äººã‚·ã‚§ã‚¢</div>
    <div id="bandChart"></div>
    <div style="margin-top:12px;display:flex;gap:12px;justify-content:center;flex-wrap:wrap">
      <div style="display:flex;align-items:center;gap:5px;font-size:10px;color:#aaa">
        <div style="width:10px;height:10px;border-radius:2px;background:#818cf8"></div>æ³•äººãƒ»å›£ä½“
      </div>
      <div style="display:flex;align-items:center;gap:5px;font-size:10px;color:#aaa">
        <div style="width:10px;height:10px;border-radius:2px;background:#4ade80"></div>å€‹äºº
      </div>
    </div>
  </div>

  <!-- Key insight box -->
  <div style="background:rgba(251,191,36,0.08);border:1px solid rgba(251,191,36,0.3);border-radius:14px;padding:14px 16px;max-width:600px;margin:0 auto 14px">
    <div style="color:#fbbf24;font-size:12px;font-weight:700;margin-bottom:8px">ğŸ’¡ æ§‹é€ ã®ãƒã‚¤ãƒ³ãƒˆ</div>
    <div style="color:#d1d5db;font-size:11px;line-height:1.8">
      â€¢ çµŒå–¶ä½“æ•°ã¯<span style="color:#fbbf24">96.5%ãŒå€‹äºº</span>ã ãŒã€å£²ä¸Šã§ã¯æ³•äººãƒ»å›£ä½“ãŒ<span style="color:#818cf8">40%</span>ã‚’å ã‚ã‚‹<br>
      â€¢ <span style="color:#f87171">5å„„å††è¶…</span>ã®å¤§è¦æ¨¡çµŒå–¶ä½“ã®<span style="color:#f87171">9å‰²å¼·</span>ãŒæ³•äºº<br>
      â€¢ æ³•äººã®è²©å£²é‡‘é¡ã‚·ã‚§ã‚¢ã¯2005å¹´ã®ç´„15%ã‹ã‚‰<span style="color:#fbbf24">25å¹´ã§2.7å€</span>ã«æ‹¡å¤§ä¸­<br>
      â€¢ å€‹äººã®å¤§å¤šæ•°ã¯<span style="color:#4ade80">100ä¸‡å††æœªæº€ã®å°è¦æ¨¡</span>å‰¯æ¥­ãƒ»é«˜é½¢è¾²å®¶
    </div>
  </div>

</div>


<!-- VIEW INDIV -->
<div id="view-indiv" class="view">

  <div style="max-width:600px;margin:0 auto 8px;text-align:center">
    <div style="color:#86efac;font-size:clamp(12px,3.5vw,14px);font-weight:900;margin-bottom:2px">ğŸ‘¤ å€‹äººçµŒå–¶ä½“ è©³ç´°åˆ†æ</div>
    <div style="color:#64748b;font-size:10px">2020å¹´è¾²æ—æ¥­ã‚»ãƒ³ã‚µã‚¹ï¼ˆè¾²æ°´çœï¼‰æ¨è¨ˆ / å…¨å›½ç´„103.7ä¸‡çµŒå–¶ä½“</div>
  </div>

  <!-- Toggle buttons -->
  <div style="max-width:600px;margin:0 auto 12px;display:flex;gap:8px;justify-content:center">
    <button id="indiv-btn-sales" onclick="showIndivChart('sales')"
      style="flex:1;padding:8px;border-radius:10px;border:none;cursor:pointer;font-family:inherit;font-size:clamp(10px,2.8vw,12px);font-weight:700;background:linear-gradient(90deg,#22c55e,#84cc16);color:#000;-webkit-tap-highlight-color:transparent">
      ğŸ“Š å£²ä¸Šè¦æ¨¡åˆ¥
    </button>
    <button id="indiv-btn-region" onclick="showIndivChart('region')"
      style="flex:1;padding:8px;border-radius:10px;border:none;cursor:pointer;font-family:inherit;font-size:clamp(10px,2.8vw,12px);font-weight:700;background:rgba(255,255,255,0.07);color:#86efac;-webkit-tap-highlight-color:transparent">
      ğŸ—¾ åœ°åŸŸåˆ¥
    </button>
    <button id="indiv-btn-both" onclick="showIndivChart('both')"
      style="flex:1;padding:8px;border-radius:10px;border:none;cursor:pointer;font-family:inherit;font-size:clamp(10px,2.8vw,12px);font-weight:700;background:rgba(255,255,255,0.07);color:#86efac;-webkit-tap-highlight-color:transparent">
      ğŸ”€ é‡ã­ã¦æ¯”è¼ƒ
    </button>
  </div>

  <!-- Sales chart -->
  <div id="indiv-sales-box" style="background:rgba(255,255,255,0.04);border:1px solid rgba(134,239,172,0.15);border-radius:18px;padding:16px 12px 14px;max-width:600px;margin:0 auto 14px">
    <div style="text-align:center;color:#86efac;font-size:12px;font-weight:700;margin-bottom:4px">å£²ä¸Šè¦æ¨¡åˆ¥ å€‹äººçµŒå–¶ä½“æ•°</div>
    <div style="text-align:center;color:#64748b;font-size:10px;margin-bottom:10px">ï¼ˆæ¨è¨ˆ / å…¨ä½“ã«å ã‚ã‚‹å‰²åˆï¼‰</div>
    <canvas id="indivSalesChart"></canvas>
    <div style="margin-top:12px;background:rgba(74,222,128,0.06);border-radius:10px;padding:10px 12px">
      <div style="color:#4ade80;font-size:11px;font-weight:700;margin-bottom:6px">ğŸ“Œ æ§‹æˆã®ãƒã‚¤ãƒ³ãƒˆ</div>
      <div id="salesInsight" style="color:#94a3b8;font-size:10px;line-height:1.8"></div>
    </div>
  </div>

  <!-- Region chart -->
  <div id="indiv-region-box" style="display:none;background:rgba(255,255,255,0.04);border:1px solid rgba(134,239,172,0.15);border-radius:18px;padding:16px 12px 14px;max-width:600px;margin:0 auto 14px">
    <div style="text-align:center;color:#86efac;font-size:12px;font-weight:700;margin-bottom:4px">åœ°åŸŸåˆ¥ å€‹äººçµŒå–¶ä½“æ•°</div>
    <div style="text-align:center;color:#64748b;font-size:10px;margin-bottom:10px">ï¼ˆåƒçµŒå–¶ä½“ï¼‰</div>
    <canvas id="indivRegionChart"></canvas>
    <div style="margin-top:12px;display:grid;grid-template-columns:1fr 1fr;gap:8px" id="regionCards"></div>
  </div>

  <!-- Both combined chart -->
  <div id="indiv-both-box" style="display:none;background:rgba(255,255,255,0.04);border:1px solid rgba(134,239,172,0.15);border-radius:18px;padding:16px 12px 14px;max-width:600px;margin:0 auto 14px">
    <div style="text-align:center;color:#86efac;font-size:12px;font-weight:700;margin-bottom:4px">åœ°åŸŸ Ã— å£²ä¸Šè¦æ¨¡ æ¯”è¼ƒ</div>
    <div style="text-align:center;color:#64748b;font-size:10px;margin-bottom:10px">å„åœ°åŸŸã®è¦æ¨¡åˆ¥æ§‹æˆï¼ˆç©ã¿ä¸Šã’æ£’ï¼‰</div>
    <canvas id="indivBothChart"></canvas>
    <div style="display:flex;justify-content:center;gap:10px;margin-top:10px;flex-wrap:wrap" id="bothLegend"></div>
  </div>

</div>

<p class="note">
  â€» 2020å¹´è¾²æ—æ¥­ã‚»ãƒ³ã‚µã‚¹ï¼ˆè¾²æ—æ°´ç”£çœï¼‰éƒ½é“åºœçœŒãƒ‡ãƒ¼ã‚¿ã‚’åŸºã«ã—ãŸåœ°åŸŸåˆ¥æ¨è¨ˆå€¤<br>
  ç”²ä¿¡è¶Šï¼æ–°æ½Ÿãƒ»é•·é‡ãƒ»å±±æ¢¨ã€€ä¸­éƒ¨ï¼å¯Œå±±ãƒ»çŸ³å·ãƒ»ç¦äº•ãƒ»é™å²¡ãƒ»æ„›çŸ¥ãƒ»å²é˜œãƒ»ä¸‰é‡
</p>

<script>
const regions = [
  { name:"åŒ—æµ·é“", short:"åŒ—æµ·é“", total:94,  young:18, middle:28, old:48,  avgAge:64, crops:"å°éº¦ãƒ»é…ªè¾²ãƒ»ã˜ã‚ƒãŒã„ã‚‚", feature:"å¤§è¦æ¨¡è¾²æ¥­ãƒ»æ©Ÿæ¢°åŒ–ãŒé€²ã‚€", color:"#38bdf8" },
  { name:"æ±åŒ—",   short:"æ±åŒ—",   total:238, young:19, middle:45, old:174, avgAge:71, crops:"ç±³ãƒ»ã‚Šã‚“ã”ãƒ»é‡èœ",       feature:"ç±³ã©ã“ã‚ãƒ»é«˜é½¢åŒ–ãŒæœ€ã‚‚æ·±åˆ»", color:"#a78bfa" },
  { name:"é–¢æ±",   short:"é–¢æ±",   total:162, young:22, middle:37, old:103, avgAge:68, crops:"é‡èœãƒ»ç±³ãƒ»ç•œç”£",         feature:"éƒ½å¸‚è¿‘éƒŠè¾²æ¥­ãƒ»é‡èœå¤§ç”£åœ°",  color:"#34d399" },
  { name:"ç”²ä¿¡è¶Š", short:"ç”²ä¿¡è¶Š", total:118, young:14, middle:24, old:80,  avgAge:69, crops:"ç±³ãƒ»æœç‰©ãƒ»é‡èœ",          feature:"é•·é‡ã¯å¤šå“ç›®ãƒ»é«˜åŸé‡èœç”£åœ°", color:"#fb923c" },
  { name:"ä¸­éƒ¨",   short:"ä¸­éƒ¨",   total:155, young:23, middle:38, old:94,  avgAge:67, crops:"é‡èœãƒ»ç±³ãƒ»èŠ±ã",          feature:"æ–½è¨­åœ’èŠ¸ãƒ»èŠ±ãå¤§ç”£åœ°ï¼ˆæ„›çŸ¥ï¼‰",color:"#fbbf24" },
  { name:"é–¢è¥¿",   short:"é–¢è¥¿",   total:97,  young:12, middle:21, old:64,  avgAge:69, crops:"ç±³ãƒ»é‡èœãƒ»æœç‰©",          feature:"å…µåº«ãƒ»äº¬éƒ½ã§ç±³ãƒ»æœæ¨¹ãŒä¸­å¿ƒ", color:"#f472b6" },
  { name:"ä¸­å›½ãƒ»å››å›½", short:"ä¸­å›½å››å›½", total:165, young:14, middle:31, old:120, avgAge:71, crops:"ç±³ãƒ»ã¿ã‹ã‚“ãƒ»é‡èœ", feature:"ä¸­å±±é–“åœ°åŸŸå¤šãé«˜é½¢åŒ–æ·±åˆ»",  color:"#4ade80" },
  { name:"ä¹å·ãƒ»æ²–ç¸„", short:"ä¹å·æ²–ç¸„", total:334, young:47, middle:74, old:213, avgAge:67, crops:"é‡èœãƒ»ç•œç”£ãƒ»ã•ã¨ã†ãã³", feature:"è¾²æ¥­å¾“äº‹è€…æœ€å¤šãƒ»æ¯”è¼ƒçš„è‹¥ã„",  color:"#f87171" },
];
const totalNation = regions.reduce((s,r) => s+r.total, 0);
const GRID = "rgba(255,255,255,0.07)", TICK = "#86efac";

// --- View 1 ---
new Chart(document.getElementById("regionalChart"), {
  type: "bar",
  data: {
    labels: regions.map(r => r.short),
    datasets: [
      { label:"è‹¥å¹´ï¼ˆã€œ49æ­³ï¼‰",  data: regions.map(r=>r.young),  backgroundColor:"#4ade80", stack:"a" },
      { label:"ä¸­å¹´ï¼ˆ50ã€œ64æ­³ï¼‰",data: regions.map(r=>r.middle), backgroundColor:"#facc15", stack:"a" },
      { label:"é«˜é½¢ï¼ˆ65æ­³ã€œï¼‰",  data: regions.map(r=>r.old),   backgroundColor:"#f87171", stack:"a", borderRadius:{topLeft:4,topRight:4} },
    ]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { display: false },
      tooltip: { callbacks: { label: ctx => ` ${ctx.dataset.label}ï¼š${ctx.raw}åƒäºº` } }
    },
    scales: {
      x: { stacked:true, ticks:{color:TICK,font:{size:9},maxRotation:30}, grid:{color:GRID} },
      y: { stacked:true, ticks:{color:TICK,callback:v=>v+"åƒ"}, grid:{color:GRID} }
    }
  }
});

// --- View 2 ---
let detailChart = null;
const btnWrap = document.getElementById("regionBtns");
regions.forEach((r,i) => {
  const b = document.createElement("button");
  b.className = "rgn-btn" + (i===0?" active":"");
  b.textContent = r.short;
  b.onclick = () => {
    document.querySelectorAll(".rgn-btn").forEach((x,j) => x.className="rgn-btn"+(j===i?" active":""));
    updateDetail(i);
  };
  btnWrap.appendChild(b);
});

function updateDetail(i) {
  const r = regions[i];
  const yPct = (r.young/r.total*100).toFixed(1);
  document.getElementById("d-total").textContent = r.total+"åƒäºº";
  document.getElementById("d-total").style.color = r.color;
  document.getElementById("d-pct").textContent = `å…¨å›½ã‚·ã‚§ã‚¢ ${(r.total/totalNation*100).toFixed(1)}%`;
  const ageEl = document.getElementById("d-age");
  ageEl.textContent = r.avgAge+"æ­³";
  ageEl.style.color = r.avgAge>=70?"#f87171":r.avgAge>=68?"#facc15":"#4ade80";
  document.getElementById("d-age-label").textContent = r.avgAge>=70?"âš ï¸ é«˜é½¢åŒ–æ·±åˆ»":r.avgAge<=65?"âœ… æ¯”è¼ƒçš„è‹¥ã„":"å¹³å‡çš„ãƒ¬ãƒ™ãƒ«";
  document.getElementById("d-young").textContent = yPct+"%";
  document.getElementById("d-young").style.color = "#4ade80";
  document.getElementById("d-young-abs").textContent = r.young+"åƒäºº";
  document.getElementById("d-crop").textContent = r.crops;
  document.getElementById("d-feature").textContent = r.feature;
  document.getElementById("d-chart-title").textContent = r.name + " ã®å¹´é½¢å±¤æ§‹æˆ";

  if (detailChart) detailChart.destroy();
  detailChart = new Chart(document.getElementById("detailChart"), {
    type: "doughnut",
    data: {
      labels: ["è‹¥å¹´ï¼ˆã€œ49æ­³ï¼‰","ä¸­å¹´ï¼ˆ50ã€œ64æ­³ï¼‰","é«˜é½¢ï¼ˆ65æ­³ã€œï¼‰"],
      datasets: [{ data:[r.young,r.middle,r.old],
        backgroundColor:["#4ade80bb","#facc15bb","#f87171bb"],
        borderColor:["#4ade80","#facc15","#f87171"], borderWidth:2, hoverOffset:8 }]
    },
    options: {
      responsive: true, cutout:"60%",
      plugins: {
        legend: { position:"bottom", labels:{color:"#ccc",font:{size:11},boxWidth:12,padding:12} },
        tooltip: { callbacks: { label: ctx=>`${ctx.label}ï¼š${ctx.raw}åƒäºº (${Math.round(ctx.raw/r.total*100)}%)` }}
      }
    }
  });
}
updateDetail(0);

// --- View 3 ---
function buildRanking(listId, sortedData, valFn, colorFn, formatFn) {
  const wrap = document.getElementById(listId);
  const maxVal = valFn(sortedData[0]);
  sortedData.forEach((r,i) => {
    const v = valFn(r);
    const pct = Math.round(v/maxVal*100);
    wrap.innerHTML += `<div class="insight-row">
      <div class="insight-name" style="color:${r.color}">${i+1}. ${r.short}</div>
      <div class="insight-bar-wrap"><div class="insight-bar" style="width:${pct}%;background:${r.color}88"></div></div>
      <div class="insight-num" style="color:${colorFn(r)}">${formatFn(r,v)}</div>
    </div>`;
  });
}

buildRanking("youngRankList",
  [...regions].sort((a,b) => b.young/b.total - a.young/a.total),
  r => r.young/r.total,
  r => "#4ade80",
  (r,v) => (v*100).toFixed(1)+"%"
);
buildRanking("ageRankList",
  [...regions].sort((a,b) => a.avgAge - b.avgAge),
  r => 80-r.avgAge,
  r => r.avgAge>=70?"#f87171":r.avgAge>=68?"#facc15":"#4ade80",
  (r) => r.avgAge+"æ­³"
);
buildRanking("totalRankList",
  [...regions].sort((a,b) => b.total - a.total),
  r => r.total,
  r => r.color,
  (r) => r.total+"åƒäºº"
);


// --- Bubble chart: weightIndex = weighted avg of main crop heaviness ---
// é‡ã•æŒ‡æ•°: ç±³5, éº¦5, é…ªè¾²4, ç•œç”£4, æœæ¨¹3.5, é‡èœ3, èŠ±ã1.5, ã•ã¨ã†ãã³4
const bubbleRegions = [
  { ...regions[0], weight: 4.5 }, // åŒ—æµ·é“: å°éº¦ãƒ»é…ªè¾²
  { ...regions[1], weight: 5.0 }, // æ±åŒ—: ç±³ã©ã“ã‚
  { ...regions[2], weight: 3.0 }, // é–¢æ±: é‡èœå¤šã‚
  { ...regions[3], weight: 4.2 }, // ç”²ä¿¡è¶Š: ç±³ãƒ»æœç‰©
  { ...regions[4], weight: 2.0 }, // ä¸­éƒ¨: èŠ±ããƒ»æ–½è¨­é‡èœ
  { ...regions[5], weight: 3.8 }, // é–¢è¥¿: ç±³ãƒ»é‡èœ
  { ...regions[6], weight: 4.8 }, // ä¸­å›½å››å›½: ç±³ãƒ»ã¿ã‹ã‚“
  { ...regions[7], weight: 2.5 }, // ä¹å·æ²–ç¸„: é‡èœãƒ»ç•œç”£
];

// Label plugin
const labelPlugin = {
  id: 'bubbleLabels',
  afterDatasetsDraw(chart) {
    const ctx = chart.ctx;
    chart.data.datasets.forEach((ds, i) => {
      const meta = chart.getDatasetMeta(i);
      meta.data.forEach(el => {
        const {x, y} = el.getProps(['x','y'], true);
        const r = ds.data[0].r;
        ctx.save();
        ctx.font = `bold ${Math.max(8, Math.min(r*0.5, 11))}px 'Noto Sans JP',sans-serif`;
        ctx.fillStyle = 'rgba(255,255,255,0.92)';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(ds.data[0].label, x, y);
        ctx.restore();
      });
    });
  }
};

new Chart(document.getElementById("bubbleChart"), {
  type: "bubble",
  plugins: [labelPlugin],
  data: {
    datasets: bubbleRegions.map(r => ({
      label: r.short,
      data: [{ x: r.weight, y: r.avgAge, r: Math.round(Math.sqrt(r.total)*1.5), label: r.short }],
      backgroundColor: r.color + "bb",
      borderColor: r.color,
      borderWidth: 1.5,
    }))
  },
  options: {
    responsive: true,
    plugins: {
      legend: { display: false },
      tooltip: { callbacks: {
        label: ctx => {
          const r = bubbleRegions[ctx.datasetIndex];
          return [` ${r.name}`, ` é‡ã•æŒ‡æ•°: ${r.weight}`, ` å¹³å‡å¹´é½¢: ${r.avgAge}æ­³`, ` å¾“äº‹è€…æ•°: ${r.total}åƒäºº`];
        }
      }}
    },
    scales: {
      x: {
        min: 1.0, max: 5.8,
        title: { display: true, text: 'â† è»½ã„ä½œæ¥­ã€€ã€€ã€€é‡ã„ä½œæ¥­ â†’', color: TICK, font:{size:10} },
        ticks: { color: TICK, font:{size:9}, callback: v => ({2:'è»½ã„',3:'ä¸­ç¨‹åº¦',4:'ã‚„ã‚„é‡',5:'é‡ã„'}[v]||'') },
        grid: { color: GRID }
      },
      y: {
        min: 61, max: 74,
        title: { display: true, text: 'å¹³å‡å¹´é½¢ï¼ˆæ­³ï¼‰', color: TICK, font:{size:10} },
        ticks: { color: TICK, font:{size:10}, callback: v => v+'æ­³' },
        grid: { color: GRID }
      }
    }
  }
});

// Legend cards
const bLegend = document.getElementById("bubbleLegend");
bubbleRegions.forEach(r => {
  bLegend.innerHTML += `<div style="display:flex;gap:8px;align-items:flex-start;background:rgba(255,255,255,0.04);border-radius:10px;padding:8px 10px;border:1px solid ${r.color}44">
    <div style="width:10px;height:10px;border-radius:50%;background:${r.color};margin-top:3px;flex-shrink:0"></div>
    <div>
      <div style="font-size:11px;font-weight:700;color:${r.color}">${r.short}</div>
      <div style="font-size:9px;color:#64748b;margin-top:1px">${r.crops}</div>
    </div>
  </div>`;
});



// --- Corp charts ---
// Donut
new Chart(document.getElementById('corpDonut'), {
  type: 'doughnut',
  data: {
    labels: ['æ³•äººãƒ»å›£ä½“', 'å€‹äºº'],
    datasets: [{ data: [40, 60],
      backgroundColor: ['#818cf8cc','#4ade80cc'],
      borderColor: ['#818cf8','#4ade80'], borderWidth: 2, hoverOffset: 6 }]
  },
  options: {
    responsive: true, cutout: '62%',
    plugins: {
      legend: { position:'bottom', labels:{ color:'#ccc', font:{size:10}, boxWidth:10, padding:8 }},
      tooltip: { callbacks:{ label: ctx => ` ${ctx.label}: ${ctx.raw}%` }}
    }
  }
});

// Trend line
new Chart(document.getElementById('corpTrend'), {
  type: 'line',
  data: {
    labels: ['2005','2010','2015','2020'],
    datasets: [{
      label: 'æ³•äººãƒ»å›£ä½“ã‚·ã‚§ã‚¢',
      data: [15, 23, 32, 40],
      borderColor: '#818cf8', backgroundColor: '#818cf822',
      borderWidth: 2.5, pointRadius: 4, pointBackgroundColor: '#818cf8',
      fill: true, tension: 0.3
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { display: false },
      tooltip: { callbacks:{ label: ctx => ` ${ctx.raw}%` }}
    },
    scales: {
      x: { ticks:{ color:TICK, font:{size:9} }, grid:{ color:GRID }},
      y: { min:0, max:55, ticks:{ color:TICK, font:{size:9}, callback: v=>v+'%' }, grid:{ color:GRID }}
    }
  }
});

// Band breakdown horizontal bars
const bands = [
  { label:'500ä¸‡å††æœªæº€',    corp: 3,  ind: 97 },
  { label:'500ä¸‡ã€œ1000ä¸‡',  corp: 9,  ind: 91 },
  { label:'1000ä¸‡ã€œ3000ä¸‡', corp: 20, ind: 80 },
  { label:'3000ä¸‡ã€œ5000ä¸‡', corp: 35, ind: 65 },
  { label:'5000ä¸‡ã€œ1å„„',    corp: 46, ind: 54 },
  { label:'1å„„ã€œ5å„„',       corp: 62, ind: 38 },
  { label:'5å„„å††ä»¥ä¸Š',      corp: 92, ind:  8 },
];
const bandWrap = document.getElementById('bandChart');
bands.forEach(b => {
  bandWrap.innerHTML += `
  <div style="margin-bottom:9px">
    <div style="display:flex;justify-content:space-between;margin-bottom:3px">
      <span style="font-size:10px;color:#ccc">${b.label}</span>
      <span style="font-size:10px;color:#818cf8;font-weight:700">${b.corp}%</span>
    </div>
    <div style="height:12px;border-radius:6px;overflow:hidden;background:rgba(255,255,255,0.07);display:flex">
      <div style="width:${b.corp}%;background:linear-gradient(90deg,#818cf8,#a5b4fc);border-radius:6px 0 0 6px"></div>
      <div style="flex:1;background:linear-gradient(90deg,#4ade80,#22c55e)"></div>
    </div>
  </div>`;
});



// --- Individual detail charts ---
// Sales band data (å€‹äººçµŒå–¶ä½“ æ¨è¨ˆ ä¸‡çµŒå–¶ä½“)
// 2020ã‚»ãƒ³ã‚µã‚¹ è²©å£²é‡‘é¡è¦æ¨¡åˆ¥çµŒå–¶ä½“æ•°ã‹ã‚‰å€‹äººçµŒå–¶ä½“åˆ†ã‚’æ¨è¨ˆ
// å…¨ä½“107.6ä¸‡ ã†ã¡å€‹äºº103.7ä¸‡
const salesBands = [
  { label:'50ä¸‡å††æœªæº€',      count: 31.0, pct: 29.9, color:'#94a3b8' },
  { label:'50ã€œ100ä¸‡å††',     count: 18.5, pct: 17.8, color:'#86efac' },
  { label:'100ã€œ300ä¸‡å††',    count: 26.0, pct: 25.1, color:'#4ade80' },
  { label:'300ã€œ500ä¸‡å††',    count:  9.8, pct:  9.5, color:'#22c55e' },
  { label:'500ä¸‡ã€œ1000ä¸‡å††', count:  8.2, pct:  7.9, color:'#facc15' },
  { label:'1000ã€œ3000ä¸‡å††',  count:  6.4, pct:  6.2, color:'#fb923c' },
  { label:'3000ä¸‡ã€œ1å„„å††',   count:  2.8, pct:  2.7, color:'#f87171' },
  { label:'1å„„å††ä»¥ä¸Š',       count:  1.0, pct:  0.9, color:'#a78bfa' },
];

// Regional data (å€‹äººçµŒå–¶ä½“æ•° åƒçµŒå–¶ä½“ æ¨è¨ˆ)
const indivRegions = [
  { name:'åŒ—æµ·é“',   short:'åŒ—æµ·é“',   count: 44,  color:'#38bdf8', main:'å¤§è¦æ¨¡ãƒ»ä¸»æ¥­ãŒå¤šãå€‹äººã§ã‚‚è¦æ¨¡å¤§' },
  { name:'æ±åŒ—',     short:'æ±åŒ—',     count: 185, color:'#a78bfa', main:'å‰¯æ¥­çš„ãƒ»é«˜é½¢å€‹äººãŒå¤šã„' },
  { name:'é–¢æ±',     short:'é–¢æ±',     count: 141, color:'#34d399', main:'éƒ½å¸‚è¿‘éƒŠã®å…¼æ¥­è¾²å®¶ãŒå¤šæ•°' },
  { name:'ç”²ä¿¡è¶Š',   short:'ç”²ä¿¡è¶Š',   count: 106, color:'#fb923c', main:'ç±³ãƒ»æœæ¨¹ã®å€‹äººè¾²å®¶ãŒä¸­å¿ƒ' },
  { name:'ä¸­éƒ¨',     short:'ä¸­éƒ¨',     count: 133, color:'#fbbf24', main:'æ–½è¨­åœ’èŠ¸ã®å€‹äººã‚‚å¤šã„' },
  { name:'é–¢è¥¿',     short:'é–¢è¥¿',     count:  86, color:'#f472b6', main:'å‰¯æ¥­ãƒ»é«˜é½¢åŒ–ãŒæ·±åˆ»ãªåœ°åŸŸ' },
  { name:'ä¸­å›½ãƒ»å››å›½', short:'ä¸­å›½å››å›½', count: 148, color:'#4ade80', main:'æ£šç”°ãƒ»ä¸­å±±é–“åœ°ã®å°è¦æ¨¡å¤šæ•°' },
  { name:'ä¹å·ãƒ»æ²–ç¸„', short:'ä¹å·æ²–ç¸„', count: 294, color:'#f87171', main:'æœ€å¤šãƒ»é‡èœãƒ»ç•œç”£ã®å€‹äººè¾²å®¶' },
];

let indivSalesChart = null, indivRegionChart = null, indivBothChart = null;

function showIndivChart(type) {
  // Toggle visibility
  document.getElementById('indiv-sales-box').style.display = type==='sales'||type==='both' ? 'block':'none';
  document.getElementById('indiv-region-box').style.display = type==='region'||type==='both' ? 'block':'none';
  document.getElementById('indiv-both-box').style.display = type==='both' ? 'block':'none';

  // Style buttons
  ['sales','region','both'].forEach(k => {
    const b = document.getElementById('indiv-btn-'+k);
    if(k===type) {
      b.style.background = 'linear-gradient(90deg,#22c55e,#84cc16)';
      b.style.color = '#000';
    } else {
      b.style.background = 'rgba(255,255,255,0.07)';
      b.style.color = '#86efac';
    }
  });

  if((type==='sales'||type==='both') && !indivSalesChart) buildSalesChart();
  if((type==='region'||type==='both') && !indivRegionChart) buildRegionChart();
  if(type==='both' && !indivBothChart) buildBothChart();
}

function buildSalesChart() {
  indivSalesChart = new Chart(document.getElementById('indivSalesChart'), {
    type: 'bar',
    data: {
      labels: salesBands.map(b => b.label),
      datasets: [{
        label: 'çµŒå–¶ä½“æ•°ï¼ˆä¸‡ï¼‰',
        data: salesBands.map(b => b.count),
        backgroundColor: salesBands.map(b => b.color+'cc'),
        borderColor: salesBands.map(b => b.color),
        borderWidth: 1.5, borderRadius: 5,
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display:false },
        tooltip: { callbacks: { label: ctx => ` ${ctx.raw}ä¸‡çµŒå–¶ä½“ï¼ˆ${salesBands[ctx.dataIndex].pct}%ï¼‰` }}
      },
      scales: {
        x: { ticks:{ color:TICK, font:{size:8}, maxRotation:35 }, grid:{color:GRID} },
        y: { ticks:{ color:TICK, callback:v=>v+'ä¸‡' }, grid:{color:GRID} }
      }
    }
  });
  // Insight text
  document.getElementById('salesInsight').innerHTML =
    'â€¢ <span style="color:#94a3b8">100ä¸‡å††æœªæº€</span>ãŒå…¨ä½“ã®<span style="color:#f87171;font-weight:700">47.7%</span>ï¼ˆå‰¯æ¥­ãƒ»é«˜é½¢ã®å°è¦æ¨¡è¾²å®¶ï¼‰<br>' +
    'â€¢ <span style="color:#4ade80">100ã€œ500ä¸‡å††</span>ãŒ<span style="color:#4ade80;font-weight:700">34.6%</span>ï¼ˆæº–ä¸»æ¥­ãƒ»å…¼æ¥­è¾²å®¶å±¤ï¼‰<br>' +
    'â€¢ <span style="color:#facc15">500ä¸‡å††ä»¥ä¸Š</span>ã¯å…¨ä½“ã®<span style="color:#facc15;font-weight:700">17.7%</span>ã®ã¿ï¼ˆä¸»æ¥­è¾²å®¶ï¼‰<br>' +
    'â€¢ <span style="color:#a78bfa">1å„„å††è¶…</span>ã®å€‹äººçµŒå–¶ä½“ã‚‚ç´„<span style="color:#a78bfa;font-weight:700">1ä¸‡çµŒå–¶ä½“</span>å­˜åœ¨';
}

function buildRegionChart() {
  indivRegionChart = new Chart(document.getElementById('indivRegionChart'), {
    type: 'bar',
    data: {
      labels: indivRegions.map(r => r.short),
      datasets: [{
        label: 'å€‹äººçµŒå–¶ä½“æ•°',
        data: indivRegions.map(r => r.count),
        backgroundColor: indivRegions.map(r => r.color+'bb'),
        borderColor: indivRegions.map(r => r.color),
        borderWidth: 1.5, borderRadius: 5,
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display:false },
        tooltip: { callbacks: { label: ctx => ` ${ctx.raw}åƒçµŒå–¶ä½“` }}
      },
      scales: {
        x: { ticks:{ color:TICK, font:{size:9}, maxRotation:30 }, grid:{color:GRID} },
        y: { ticks:{ color:TICK, callback:v=>v+'åƒ' }, grid:{color:GRID} }
      }
    }
  });
  // Region cards
  const wrap = document.getElementById('regionCards');
  indivRegions.forEach(r => {
    const pct = (r.count / indivRegions.reduce((s,x)=>s+x.count,0)*100).toFixed(1);
    wrap.innerHTML += `<div style="background:rgba(255,255,255,0.04);border:1px solid ${r.color}44;border-radius:10px;padding:9px 11px">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:3px">
        <span style="color:${r.color};font-size:11px;font-weight:700">${r.short}</span>
        <span style="color:${r.color};font-size:13px;font-weight:900">${r.count}åƒ</span>
      </div>
      <div style="height:5px;background:rgba(255,255,255,0.08);border-radius:99px;overflow:hidden;margin-bottom:4px">
        <div style="height:100%;width:${r.count/294*100}%;background:${r.color};border-radius:99px"></div>
      </div>
      <div style="color:#64748b;font-size:9px">${r.main}</div>
    </div>`;
  });
}

function buildBothChart() {
  // å„åœ°åŸŸã‚’å£²ä¸Šè¦æ¨¡åˆ¥ã«åˆ†è§£ï¼ˆåœ°åŸŸç‰¹æ€§ã‚’åæ˜ ã—ãŸæ¨è¨ˆï¼‰
  // åˆ—: [50ä¸‡æœªæº€, 50-100ä¸‡, 100-300ä¸‡, 300-500ä¸‡, 500-1000ä¸‡, 1000-3000ä¸‡, 3000ä¸‡-1å„„, 1å„„+]
  const regionalSales = {
    'åŒ—æµ·é“':   [10, 10, 15, 14, 16, 18, 12,  5],
    'æ±åŒ—':     [34, 20, 24, 10,  6,  4,  1.5, 0.5],
    'é–¢æ±':     [26, 18, 26, 11,  9,  7,  2.5, 0.5],
    'ç”²ä¿¡è¶Š':   [30, 20, 25, 10,  7,  6,  1.5, 0.5],
    'ä¸­éƒ¨':     [25, 18, 26, 12, 10,  7,  1.5, 0.5],
    'é–¢è¥¿':     [38, 22, 24,  8,  5,  2.5, 0.4, 0.1],
    'ä¸­å›½å››å›½': [36, 22, 25,  9,  5,  2.5, 0.4, 0.1],
    'ä¹å·æ²–ç¸„': [25, 17, 26, 12, 10,  7,  2.5, 0.5],
  };
  const bandColors = ['#94a3b8','#86efac','#4ade80','#22c55e','#facc15','#fb923c','#f87171','#a78bfa'];
  const bandNames = ['50ä¸‡æœªæº€','50ã€œ100ä¸‡','100ã€œ300ä¸‡','300ã€œ500ä¸‡','500ã€œ1000ä¸‡','1000ã€œ3000ä¸‡','3000ä¸‡ã€œ1å„„','1å„„+'];

  const datasets = bandNames.map((name, i) => ({
    label: name,
    data: indivRegions.map(r => regionalSales[r.short][i]),
    backgroundColor: bandColors[i]+'cc',
    stack: 'a',
    borderRadius: i===7 ? {topLeft:4,topRight:4} : 0,
  }));

  indivBothChart = new Chart(document.getElementById('indivBothChart'), {
    type: 'bar',
    data: { labels: indivRegions.map(r => r.short), datasets },
    options: {
      responsive: true,
      plugins: {
        legend: { display:false },
        tooltip: { callbacks: { label: ctx => ` ${ctx.dataset.label}ï¼š${ctx.raw}%` }}
      },
      scales: {
        x: { stacked:true, ticks:{color:TICK,font:{size:9},maxRotation:30}, grid:{color:GRID} },
        y: { stacked:true, max:100, ticks:{color:TICK,callback:v=>v+'%'}, grid:{color:GRID} }
      }
    }
  });

  // Legend
  const legWrap = document.getElementById('bothLegend');
  bandNames.forEach((n,i) => {
    legWrap.innerHTML += `<div style="display:flex;align-items:center;gap:4px;font-size:9px;color:#aaa">
      <div style="width:9px;height:9px;border-radius:2px;background:${bandColors[i]};flex-shrink:0"></div>${n}</div>`;
  });
}

// Init first chart
showIndivChart('sales');


// --- Tab ---
function switchView(v) {
  document.querySelectorAll(".view").forEach(el => el.classList.remove("active"));
  document.getElementById("view-"+v).classList.add("active");
  const keys = ["corp","indiv"];
  document.querySelectorAll(".tab").forEach((t,i) => t.className="tab "+(keys[i]===v?"active":"inactive"));
}
</script>
</body>
</html>
